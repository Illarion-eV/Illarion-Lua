
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Illarion Lua Reference</title>

    <style media="screen">
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cpf {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s, .highlight .sa, .highlight .dl {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf, .highlight .fm {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv, .highlight .vm {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .nl {
  color: #f92672;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <style media="print">
      * {
        -webkit-transition:none!important;
        transition:none!important;
      }
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #586e75;
}
.highlight .err {
  color: #002b36;
  background-color: #dc322f;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cm, .highlight .cpf, .highlight .c1, .highlight .cs {
  color: #657b83;
}
.highlight .cp {
  color: #b58900;
}
.highlight .nt {
  color: #b58900;
}
.highlight .o, .highlight .ow {
  color: #93a1a1;
}
.highlight .p, .highlight .pi {
  color: #93a1a1;
}
.highlight .gi {
  color: #859900;
}
.highlight .gd {
  color: #dc322f;
}
.highlight .gh {
  color: #268bd2;
  background-color: #002b36;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #6c71c4;
}
.highlight .kc {
  color: #cb4b16;
}
.highlight .kt {
  color: #cb4b16;
}
.highlight .kd {
  color: #cb4b16;
}
.highlight .s, .highlight .sa, .highlight .sb, .highlight .sc, .highlight .dl, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #859900;
}
.highlight .sr {
  color: #2aa198;
}
.highlight .si {
  color: #d33682;
}
.highlight .se {
  color: #d33682;
}
.highlight .nn {
  color: #b58900;
}
.highlight .nc {
  color: #b58900;
}
.highlight .no {
  color: #b58900;
}
.highlight .na {
  color: #268bd2;
}
.highlight .m, .highlight .mb, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mx {
  color: #859900;
}
.highlight .ss {
  color: #859900;
}
    </style>
    <link href="stylesheets/screen-cf9446c9.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print-953e3353.css" rel="stylesheet" media="print" />
      <script src="javascripts/all-e033bdd3.js"></script>

    <script>
      $(function() { setupCodeCopy(); });
    </script>
  </head>

  <body class="index" data-languages="[&quot;lua&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar-cad8cdcb.png" alt="" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo-e4cb266f.png" class="logo" alt="" />
        <div class="lang-selector">
              <a href="#" data-language-name="lua">Lua</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#learning-lua" class="toc-h2 toc-link" data-title="Learning Lua">Learning Lua</a>
                  </li>
                  <li>
                    <a href="#structure" class="toc-h2 toc-link" data-title="Structure">Structure</a>
                  </li>
                  <li>
                    <a href="#database-changes" class="toc-h2 toc-link" data-title="Database Changes">Database Changes</a>
                  </li>
                  <li>
                    <a href="#notation" class="toc-h2 toc-link" data-title="Notation">Notation</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#tutorial" class="toc-h1 toc-link" data-title="Tutorial">Tutorial</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#initial-setup" class="toc-h2 toc-link" data-title="Initial Setup">Initial Setup</a>
                  </li>
                  <li>
                    <a href="#starting-a-project" class="toc-h2 toc-link" data-title="Starting a Project">Starting a Project</a>
                  </li>
                  <li>
                    <a href="#sharing-your-work" class="toc-h2 toc-link" data-title="Sharing your Work">Sharing your Work</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#entry-points" class="toc-h1 toc-link" data-title="Entry Points">Entry Points</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#combat" class="toc-h2 toc-link" data-title="Combat">Combat</a>
                  </li>
                  <li>
                    <a href="#death" class="toc-h2 toc-link" data-title="Death">Death</a>
                  </li>
                  <li>
                    <a href="#depot" class="toc-h2 toc-link" data-title="Depot">Depot</a>
                  </li>
                  <li>
                    <a href="#fields" class="toc-h2 toc-link" data-title="Fields">Fields</a>
                  </li>
                  <li>
                    <a href="#item-inspection" class="toc-h2 toc-link" data-title="Item Inspection">Item Inspection</a>
                  </li>
                  <li>
                    <a href="#items" class="toc-h2 toc-link" data-title="Items">Items</a>
                  </li>
                  <li>
                    <a href="#learning" class="toc-h2 toc-link" data-title="Learning">Learning</a>
                  </li>
                  <li>
                    <a href="#login" class="toc-h2 toc-link" data-title="Login">Login</a>
                  </li>
                  <li>
                    <a href="#logout" class="toc-h2 toc-link" data-title="Logout">Logout</a>
                  </li>
                  <li>
                    <a href="#long-time-effects" class="toc-h2 toc-link" data-title="Long Time Effects">Long Time Effects</a>
                  </li>
                  <li>
                    <a href="#monsters" class="toc-h2 toc-link" data-title="Monsters">Monsters</a>
                  </li>
                  <li>
                    <a href="#npcs" class="toc-h2 toc-link" data-title="NPCs">NPCs</a>
                  </li>
                  <li>
                    <a href="#player-inspection" class="toc-h2 toc-link" data-title="Player Inspection">Player Inspection</a>
                  </li>
                  <li>
                    <a href="#quests" class="toc-h2 toc-link" data-title="Quests">Quests</a>
                  </li>
                  <li>
                    <a href="#reloading-scripts" class="toc-h2 toc-link" data-title="Reloading Scripts">Reloading Scripts</a>
                  </li>
                  <li>
                    <a href="#scheduled" class="toc-h2 toc-link" data-title="Scheduled">Scheduled</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#classes" class="toc-h1 toc-link" data-title="Classes">Classes</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#character" class="toc-h2 toc-link" data-title="Character">Character</a>
                  </li>
                  <li>
                    <a href="#colour" class="toc-h2 toc-link" data-title="colour">colour</a>
                  </li>
                  <li>
                    <a href="#dialogs" class="toc-h2 toc-link" data-title="Dialogs">Dialogs</a>
                  </li>
                  <li>
                    <a href="#field" class="toc-h2 toc-link" data-title="Field">Field</a>
                  </li>
                  <li>
                    <a href="#item" class="toc-h2 toc-link" data-title="Item">Item</a>
                  </li>
                  <li>
                    <a href="#itemlookat" class="toc-h2 toc-link" data-title="ItemLookAt">ItemLookAt</a>
                  </li>
                  <li>
                    <a href="#itemstruct" class="toc-h2 toc-link" data-title="ItemStruct">ItemStruct</a>
                  </li>
                  <li>
                    <a href="#long-time-effect" class="toc-h2 toc-link" data-title="Long Time Effect">Long Time Effect</a>
                  </li>
                  <li>
                    <a href="#position" class="toc-h2 toc-link" data-title="position">position</a>
                  </li>
                  <li>
                    <a href="#random" class="toc-h2 toc-link" data-title="Random">Random</a>
                  </li>
                  <li>
                    <a href="#script-variables" class="toc-h2 toc-link" data-title="Script Variables">Script Variables</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#logging" class="toc-h1 toc-link" data-title="Logging">Logging</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#functions" class="toc-h2 toc-link" data-title="Functions">Functions</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#debugging" class="toc-h1 toc-link" data-title="Debugging">Debugging</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#functions" class="toc-h2 toc-link" data-title="Functions">Functions</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#resources" class="toc-h1 toc-link" data-title="Resources">Resources</a>
          </li>
          <li>
            <a href="#common-bugs" class="toc-h1 toc-link" data-title="Common Bugs">Common Bugs</a>
          </li>
          <li>
            <a href="#changelog" class="toc-h1 toc-link" data-title="Changelog">Changelog</a>
          </li>
      </ul>
        <ul class="toc-footer">
            <li><a target="_blank" rel="noopener noreferrer" href='https://github.com/Illarion-eV/Illarion-Dev'>Local Illarion Development Server</a></li>
            <li><a target="_blank" rel="noopener noreferrer" href='https://github.com/vilarion/Illarion-Coding-Style'>Illarion Coding Style</a></li>
            <li><a target="_blank" rel="noopener noreferrer" href='https://github.com/Illarion-eV/Illarion-Lua/tree/main/source'>Documentation Sources</a></li>
            <li><a target="_blank" rel="noopener noreferrer" href='https://github.com/slatedocs/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <aside class="warning">
This documentation is still in development, but will eventually replace the current version. See changelog for details.
</aside>
<h1 id='introduction'>Introduction</h1>
<p>Illarion game content like items, NPCs, quests, etc. is defined in scripts written in
<a target="_blank" rel="noopener noreferrer" href='https://www.lua.org/manual/5.2/'>Lua 5.2</a>
with Illarion specific extensions. This document describes these extensions. Those scripts can be found in the
<a target="_blank" rel="noopener noreferrer" href='https://github.com/Illarion-eV/Illarion-Content'>
official repository</a>, which has two branches. The <code>master</code> branch reflects the scripts used by the live game, while
the <code>develop</code> branch is used to prepare the next release. You can fork that repository on GitHub and clone it to your
hard drive for development or testing using the
<a target="_blank" rel="noopener noreferrer" href='https://github.com/Illarion-eV/Illarion-Dev'>
local development server</a>.</p>

<p>The recommended editor for Illarion scripting is
<a target="_blank" rel="noopener noreferrer" href='https://code.visualstudio.com/'>
Visual Studio Code</a>, which is available for Linux, Windows and macOS. You can use the extension <code>rog2.luacheck</code> to
automatically perform some code checks ahead of pull requests. If you are using Visual Studio Code and open the
repository directory as a folder, the required ISO 8859-1 encoding will be used automatically. A more detailed
description of setting up and using a development environment is available in the <a href="#tutorial">tutorial</a>.</p>

<aside class="notice">
Scripts need to be encoded in ISO 8859-1.
</aside>
<h2 id='learning-lua'>Learning Lua</h2>
<p>If you are new to programming in general or new to Lua, you will need to learn Lua 5.2 if you want to make changes
beyond searching for and fixing text errors. Luckily Lua is a fairly simple language and I would suggest beginning by
studying <a href="https://www.lua.org/pil/contents.html">Programming in Lua</a> chapters 1 to 5.1. You can skip 1.4, since we won&#39;t
be using a stand-alone interpreter, but rather our <a href="https://github.com/Illarion-eV/Illarion-Dev">local Illarion server</a>.
While this book is geared towards Lua 5.0, the basics did not change. Before you get started, make sure to follow the
<a href="#tutorial">tutorial</a> to set up a development environment.</p>

<blockquote>
<p>Minimal script for testing Lua code</p>
</blockquote>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">M</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">UseItem</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">actionState</span><span class="p">)</span>
    <span class="c1">-- your code here</span>
<span class="k">end</span>

<span class="k">return</span> <span class="n">M</span>
</code></pre></div>
<p>While learning, you will want to test your code snippets. To do that, you can go to an item script of your choosing,
e.g. <code>item/id_9_saw.lua</code> and delete all of its contents. Then paste the example on the right and write your code inside
the <code>UseItem</code> entry point. Make sure to reload (<code>!fr</code> in the client) the server after saving your script to load any
changes. Now you can run your code by simply using that item. To create an item with e.g. id 9, use <code>!create 9</code> in your
client (the item might be created in your bag).</p>

<p>Since <code>print</code> does not exist here (where would we print output anyway), you need to use another means of producing
output. You can either use <code>log(&quot;some output text&quot;)</code> to send output to the server log, use <code>debug(&quot;some output text&quot;)</code>
to send output to the server log with a call stack, or use <code>user:inform(&quot;some output text&quot;)</code> to send output to your
client.</p>

<p>If you struggle or are not sure about something, you are always welcome to ask for help in <a href="https://illarion.org/community/us_chat.php">Discord</a>. Developers will be notified if you use the channel Development &gt;
beginners.</p>
<h2 id='structure'>Structure</h2>
<blockquote>
<p><code>item/apple.lua</code></p>
</blockquote>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="c1">-- mandatory license header omitted for the sake of brevity</span>

<span class="kd">local</span> <span class="n">M</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">UseItem</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
    <span class="c1">-- code handling items being used</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">LookAtItem</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
    <span class="c1">-- code handling items being looked at</span>
<span class="k">end</span>

<span class="c1">-- more entry points can follow</span>

<span class="k">return</span> <span class="n">M</span>
</code></pre></div>
<p>Every time a certain event happens (e.g someone using an item, a monster dying, someone logging into the game, etc.) a
script function is called. The name of that script is usually defined in the database, except for <em>server
scripts</em> which have a fixed name and implement very specific server behaviour not tied to a particular game object.</p>

<aside class="notice">
Scripts are defined inside the database using the following format:
<ul>
<li>Paths are relative to the repository base directory.</li>
<li>Directory/file names are separated by a full stop (<code>.</code>).</li>
<li>The <code>.lua</code> extension is omitted.</li>
</ul>
E.g. a script <code>item/apple.lua</code> would be entered as <code>item.apple</code>.
</aside>

<p>The executed function is called an <a href="#entry-points"><em>entry point</em></a>, since it is run directly by the server. Scripts
defined in the database, as well as server scripts, return a table containing expected entry points.
A script does not need to include <em>all</em> possible entry points. For example, if an item has no <code>UseItem</code> entry point,
nothing happens when a player uses the item.</p>

<aside class="notice">
The available set of entry points describes all game behaviour scripts can handle.
</aside>
<h2 id='database-changes'>Database Changes</h2><div class="highlight"><pre class="highlight sql tab-sql"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">triggerfields</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">330</span><span class="p">,</span> <span class="mi">536</span><span class="p">,</span> <span class="o">-</span><span class="mi">24</span><span class="p">,</span> <span class="s1">'triggerfield.irundarmirror'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">npc</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">334</span><span class="p">,</span> <span class="mi">538</span><span class="p">,</span> <span class="o">-</span><span class="mi">26</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="s1">'Neil Peter Caldori'</span><span class="p">,</span> <span class="s1">'npc.caldori'</span><span class="p">);</span>
<span class="k">UPDATE</span> <span class="n">items</span> <span class="k">SET</span> <span class="n">itm_script</span> <span class="o">=</span> <span class="s1">'item.food'</span> <span class="k">WHERE</span> <span class="n">itm_id</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
</code></pre></div>
<blockquote>
<p>In the second example everything after npc_script will get a default value. You probably do not want an NPC with white skin, though.</p>
</blockquote>

<p>You need to track all changes you make to the database. This will allow you to</p>

<ul>
<li>replay any changes if you need to reset your database to incorporate changes to the official database.</li>
<li>have a changeset to include in your pull request for testing and to update the official database upon merging.</li>
</ul>

<p>To apply your changes easily, you need to write them down in SQL. Typically these will be INSERT statements for new
database entries (new NPCs, quests, trigger fields, ...) and UPDATE statements for modifying existing entries
(e.g. adding a script to an item). The syntax is pretty simple:</p>

<p><code>INSERT INTO &lt;table name&gt; VALUES (&lt;list of all required values&gt;);</code></p>

<p><code>UPDATE &lt;table name&gt; SET &lt;field name&gt; = &lt;value&gt; WHERE &lt;id field&gt; = &lt;entry id&gt;;</code></p>

<aside class="notice">
Helpful hints for crafting SQL statements:
<ul>
<li>Database access is explained in the <a target="_blank" rel="noopener noreferrer" href='https://github.com/Illarion-eV/Illarion-Dev#7-database-access'>local server documentation</a>.</li>
<li>Strings are put in single quotes (<code>'</code>).</li>
<li>Possible boolean values are <code>true</code> and <code>false</code>.</li>
<li>If no value should be inserted for some field, use <code>NULL</code>.</li>
<li>You can omit the last values in an INSERT statement if they all have default values.</li>
<li>Do not forget the semi-colon after each SQL statement.</li>
</ul>
</aside>

<aside class="notice">
You can run your set of SQL statements against your local database after clicking "SQL" in the top right corner of
phppgadmin.
</aside>
<h2 id='notation'>Notation</h2>
<p>Function definitions in this document are given in the following format:</p>

<p><code>&lt;return values&gt; &lt;function name&gt;(&lt;parameters&gt;)</code></p>

<ul>
<li><code>return values</code> stands for a list of variables returned from the function and is omitted if the function does not
return anything.</li>
<li><code>&lt;function name&gt;</code> is the name of the function.</li>
<li><code>&lt;parameters&gt;</code> is a list of type/name pairs, separated by space. Optional parameters are given in brackets.
Default parameters are assigned the value they will be given if left out of a call.</li>
</ul>

<p>Example:</p>

<p><code>weight, value example(Item item [, number amount = 1])</code></p>

<p>The function <code>example</code> given here returns <code>weight</code> and <code>value</code>. It takes an <code>Item</code> called <code>item</code> as well as an optional
<code>number</code> called <code>amount</code> as parameters. If <code>amount</code> is not passed into the function it will be set to <code>1</code>.</p>
<h1 id='tutorial'>Tutorial</h1>
<p>This tutorial shows how to get started with Illarion content development. It gives a basic introduction into our development process and policies, i.e. what you need to know to contribute to Illarion development. We will go through the steps to set up a development environment and show how projects (even small ones, like fixing spelling errors) are started and shared.</p>

<p>Should you encounter any problems with this tutorial, please do not hesitate to ask for help on <a href="https://illarion.org/community/us_chat.php">Discord</a>. Feedback and suggestions on how to improve it are also welcome!</p>
<h2 id='initial-setup'>Initial Setup</h2>
<ol>
<li>Create a free <a href="https://github.com">GitHub</a> account if you don&#39;t have one and verify your email address.</li>
<li><a href="https://github.com/illarion-ev/illarion-content/fork">Fork</a> the Illarion game content to your GitHub account.</li>
<li><a href="https://github.com/illarion-ev/illarion-map/fork">Fork</a> the Illarion maps to your GitHub account.</li>
<li>Install and run <a href="https://code.visualstudio.com">Visual Studio Code</a>.</li>
<li>Select <em>Source Control</em> on the left tool bar, then <em>Clone Repository</em> and <em>Clone from GitHub</em>. <img src="images/tutorial/clone-838e8972.png" alt="" /></li>
<li>Authorize Visual Studio Code to access GitHub.</li>
<li>In Visual Studio Code, select the Illarion-Map repository and afterwards a location to save it to. Make sure the folder is open in Visual Studio Code.</li>
<li>Select <em>Source Control</em> again. Select <em>... &gt; Remote &gt; Add Remote...</em>, insert <code>https://github.com/Illarion-eV/Illarion-Map</code> and name it <em>upstream</em>. If asked, you can choose to periodically run <code>git fetch</code>. <img src="images/tutorial/remote-2998813f.png" alt="" /></li>
<li>On the bottom blue bar, click the current master branch and select <em>origin/develop</em>. <img src="images/tutorial/branch-cb826a4a.png" alt="" /></li>
<li>Select <em>File &gt; Close Folder</em> and repeat steps 5, 7, 8 and 9 for the Illarion-Content repository, using <code>https://github.com/Illarion-eV/Illarion-Content</code> as remote URL. Name the remote <em>upstream</em> as well.</li>
<li>Close the Illarion-Content folder and re-open it. You will be asked to install recommended extensions. Do so. These extensions will offer better support for Lua, Git and point out problems in your Lua code. <img src="images/tutorial/extensions-a187c645.png" alt="" /></li>
<li>Every change you make needs a name and an email. Use a name Illarion devs know you by and an email you can be reached at:

<ol>
<li>From the menu select <em>View &gt; Terminal</em>.</li>
<li>Enter: <code>git config --global user.name &quot;your name here&quot;</code></li>
<li>Enter: <code>git config --global user.email your@email.here</code></li>
</ol></li>
<li>Setup the <a href="https://github.com/Illarion-eV/Illarion-Dev">local Illarion development server</a>. Use your Illarion-Map and Illarion-Content directories under 2. Setup.</li>
</ol>
<h2 id='starting-a-project'>Starting a Project</h2>
<ol>
<li>Make sure the Illarion-Content folder is open and the bottom blue bar shows <em>develop</em>.</li>
<li>Select <em>Source Control</em> on the left tool bar and select <em>... &gt; Pull, Push &gt; Pull from... &gt; upstream &gt; upstream/develop</em>.</li>
<li>Select <em>develop &gt; Create new branch...</em> and name it <em>feature/hello-illarion</em>. Notice that the blue bar shows the new branch.</li>
<li>Select <em>Explorer</em> on the left bar and open <em>server &gt; login.lua</em>.</li>
<li>Find the line <code>function M.onLogin(player)</code> and under it enter <code>player:inform(&quot;Hello Illarion Development!&quot;)</code></li>
<li>Save the file.</li>
<li>Start your local server and connect with your Illarion client to check for the new login message. To reload scripts while the server is running, use the <code>!fr</code> command within the client. <img src="images/tutorial/hello-cf18e1cd.png" alt="" /></li>
<li>Under <em>Source Control</em> you can now see login.lua as a modified file. Click + to stage the changes. login.lua will now show under <em>Staged Changes</em>.</li>
<li>Enter a message title &quot;Say hello on login&quot;, insert a blank line and write a more detailed message below. Press CTRL + Enter to submit the commit of all staged changes.</li>
<li>Under <em>Source Control</em> select <em>... &gt; Push</em> to send your changes to your GitHub repository.</li>
</ol>
<h2 id='sharing-your-work'>Sharing your Work</h2>
<ol>
<li>On GitHub go to your Illarion-Content repository and in the left-hand combo box select the new <em>feature/hello-illarion</em> branch. <img src="images/tutorial/github-0f6d32b6.png" alt="" /></li>
<li>Either click <em>Compare &amp; pull request</em> or <em>Contribute &gt; Open pull request</em>.</li>
<li>Switch the base branch from <em>master</em> to <em>develop</em>.</li>
<li>Enter a suitable title and description before <strong>not</strong> clicking <em>Create pull request</em>, as this would notify a lot of developers and this is not a real project.</li>
</ol>
<h1 id='entry-points'>Entry Points</h1>
<p>As described in the <a href="#introduction">introduction</a>, entry points are the interface between server and scripts. The server
calls entry points on a variety of events to perform the implemented game mechanics. This allows the server to remain
unchanged and running, while scripts are updated at run-time.</p>

<p>Entry points are expected to be functions with pre-defined names, which the server will call. For the server to be able
to find the script these functions are in, the script is named in the db entry of the appropriate game entity. The only
exception are <em>server scripts</em>, which just have one exact name.</p>

<p>The server expects scripts to return a table, which contains all implemented entry points. In the following definitions
only the function signature is given for clarity.</p>

<p>Those scripts which are entered into the database, need to be named in the following format:</p>

<ul>
<li>Paths are relative to the repository base directory.</li>
<li>Directory/file names are seperated by a full stop (<code>.</code>).</li>
<li>The <code>.lua</code> extension is omitted.</li>
</ul>

<p>E.g. a script <code>item/apple.lua</code> would be entered as <code>item.apple</code>.</p>

<p>Some scripts provide a special global service for the server. These scripts are not attached to a specific game object
(e.g. item, monster or field), but define general or in some cases default behaviour. All of these scripts are located
in the <code>server</code> directory. Server scripts should be edited with great caution, since breaking one of those scripts would
break the related behaviour for the server.</p>

<aside class="info">
Database scripts are defined in a specific database table. Each server script is in a file with a pre-defined name.
</aside>
<h2 id='combat'>Combat</h2>
<blockquote>
<p>Combat script with all available entry points</p>
</blockquote>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">M</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">onAttack</span><span class="p">(</span><span class="n">attacker</span><span class="p">,</span> <span class="n">defender</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">return</span> <span class="n">M</span>
</code></pre></div>
<p><strong>Script file:</strong> <code>server/standardfighting.lua</code></p>
<h3 id='onattack-character-attacker-character-defender'><code>onAttack(Character attacker, Character defender)</code></h3>
<p>Is called every time <code>attacker</code> tries to hit <code>defender</code> in physical combat.</p>
<h2 id='death'>Death</h2>
<blockquote>
<p>Death script with all available entry points</p>
</blockquote>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">M</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">playerDeath</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">return</span> <span class="n">M</span>
</code></pre></div>
<p><strong>Script file:</strong> <code>server/playerdeath.lua</code></p>
<h3 id='playerdeath-character-user'><code>playerDeath(Character user)</code></h3>
<p>Is called when <code>user</code> dies. Here you can handle e.g. penalties for dying.</p>
<h2 id='depot'>Depot</h2>
<blockquote>
<p>Depot script with all available entry points</p>
</blockquote>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">M</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">onOpenDepot</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">depot</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="k">end</span>

<span class="k">return</span> <span class="n">M</span>
</code></pre></div>
<p><strong>Script file:</strong> <code>server/depot.lua</code></p>
<h3 id='boolean-onopendepot-character-user-item-depot'><code>boolean onOpenDepot(Character user, Item depot)</code></h3>
<p>Is called when <code>user</code> tries to open a <code>depot</code>. Has to return <code>true</code> if <code>user</code> is allowed to open this <code>depot</code> and
<code>false</code> otherwise.</p>
<h2 id='fields'>Fields</h2>
<p>These entry points are bound to a single field (x, y, z) on the map.</p>

<blockquote>
<p>SQL</p>
</blockquote>
<div class="highlight"><pre class="highlight sql tab-sql"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">triggerfields</span> <span class="k">VALUES</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="s1">'SCRIPT_NAME'</span><span class="p">);</span>
</code></pre></div>
<blockquote>
<p>Field script with all available entry points</p>
</blockquote>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">M</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">ItemRotsOnField</span><span class="p">(</span><span class="n">oldItem</span><span class="p">,</span> <span class="n">newItem</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">MoveFromField</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">MoveToField</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">PutItemOnField</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">TakeItemFromField</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">return</span> <span class="n">M</span>
</code></pre></div>
<p><strong>Database table:</strong> <code>triggerfields</code></p>
<h3 id='itemrotsonfield-item-olditem-item-newitem'><code>ItemRotsOnField(Item oldItem, Item newItem)</code></h3>
<aside class="info">
Currently the server does not call ItemRotsOnField.
</aside>

<p><code>oldItem</code> had its wear reduced to zero on this field and rots into <code>newItem</code>.</p>
<h3 id='movefromfield-character-user'><code>MoveFromField(Character user)</code></h3>
<p><code>user</code> moves away from this field.</p>
<h3 id='movetofield-character-user'><code>MoveToField(Character user)</code></h3>
<p><code>user</code> moves onto this field.</p>
<h3 id='putitemonfield-item-item-character-user'><code>PutItemOnField(Item item, Character user)</code></h3>
<p><code>user</code> puts <code>item</code> on this field.</p>
<h3 id='takeitemfromfield-item-item-character-user'><code>TakeItemFromField(Item item, Character user)</code></h3>
<p><code>user</code> takes <code>item</code> from this field.</p>
<h2 id='item-inspection'>Item Inspection</h2>
<blockquote>
<p>Item inspection script with all available entry points</p>
</blockquote>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">M</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">lookAtItem</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">lookAt</span> <span class="o">=</span> <span class="n">ItemLookAt</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">lookAt</span>
<span class="k">end</span>

<span class="k">return</span> <span class="n">M</span>
</code></pre></div>
<p><strong>Script file:</strong> <code>server/itemlookat.lua</code></p>
<h3 id='itemlookat-lookatitem-character-user-item-item'><code>ItemLookAt lookAtItem(Character user, Item item)</code></h3>
<p>Handles basic item inspection if <code>item</code> does not have a script with <code>LookAtItem</code> entry point. Needs to return an
<a href="#itemlookat">ItemLookAt</a>.</p>
<h2 id='items'>Items</h2>
<blockquote>
<p>SQL</p>
</blockquote>
<div class="highlight"><pre class="highlight sql tab-sql"><code><span class="k">UPDATE</span> <span class="n">items</span> <span class="k">SET</span> <span class="n">itm_script</span> <span class="o">=</span> <span class="s1">'SCRIPT_NAME'</span> <span class="k">WHERE</span> <span class="n">itm_id</span> <span class="o">=</span> <span class="n">ITEM_ID</span><span class="p">;</span>
</code></pre></div>
<blockquote>
<p>Item script with all available entry points</p>
</blockquote>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">M</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">actionDisturbed</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">disturber</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">false</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">CharacterOnField</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">LookAtItem</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">lookAt</span> <span class="o">=</span> <span class="n">ItemLookAt</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">lookAt</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">MoveItemAfterMove</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">MoveItemBeforeMove</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">UseItem</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">actionState</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">return</span> <span class="n">M</span>
</code></pre></div>
<p><strong>Database table:</strong> <code>items</code></p>
<h3 id='boolean-actiondisturbed-character-user-character-attacker'><code>boolean actionDisturbed(Character user, Character attacker)</code></h3>
<p>Is called when <code>user</code> is attacked while an action is running. This action had to be started by <code>user:startAction(...)</code>
in <code>UseItem</code>. If this entry point does not exist or returns <code>false</code> the action is not aborted. If it returns <code>true</code> the
action is aborted. See section Actions in <a href="#character">Character</a> for more details on starting actions.</p>
<h3 id='characteronfield-character-user'><code>CharacterOnField(Character user)</code></h3>
<p>Is invoked if someone steps on an item. For this entry point to be called, the corresponding
item needs to have an entry in the database table tilesmodificators with tim_specialitem set to <code>true</code>.</p>
<h3 id='itemlookat-lookatitem-character-user-item-item'><code>ItemLookAt LookAtItem(Character user, Item item)</code></h3>
<p>A <code>user</code> looks at an <code>item</code>. Needs to return an <a href="#itemlookat">ItemLookAt</a>.</p>
<h3 id='boolean-moveitembeforemove-character-user-item-source-item-target'><code>boolean MoveItemBeforeMove(Character user, Item source, Item target)</code></h3>
<p>A <code>user</code> tries to move the item <code>source</code>. After the move that item would be <code>target</code>, having a new location.
If this returns <code>true</code> or if this entry point does not exist, the move is carried out. If <code>false</code> is returned, the move
is prevented.</p>
<h3 id='moveitemaftermove-character-user-item-source-item-target'><code>MoveItemAfterMove(Character user, Item source, Item target)</code></h3>
<p>A <code>user</code> has moved the item <code>source</code>. It is now the item <code>target</code>.</p>
<h3 id='useitem-character-user-item-item-number-actionstate'><code>UseItem(Character user, Item item, number actionState)</code></h3>
<p>A <code>user</code> uses an <code>item</code>. <code>actionState</code> is one of</p>

<ul>
<li><code>Action.none</code>: no action is running.</li>
<li><code>Action.success</code>: an action was running and has been completed.</li>
<li><code>Action.abort</code>: an action was running and has been interrupted by the user being attacked or the user doing something
else like using an item, moving, etc.</li>
</ul>

<p>See section Actions in <a href="#character">Character</a> for more details on starting actions.</p>
<h2 id='learning'>Learning</h2>
<blockquote>
<p>Learning script with all available entry points</p>
</blockquote>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">M</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">learn</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">skill</span><span class="p">,</span> <span class="n">actionPoints</span><span class="p">,</span> <span class="n">learnLimit</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">reduceMC</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">return</span> <span class="n">M</span>
</code></pre></div>
<p><strong>Script file:</strong> <code>server/learn.lua</code></p>
<h3 id='learn-character-user-number-skill-number-actionpoints-number-learnlimit'><code>learn(Character user, number skill, number actionPoints, number learnLimit)</code></h3>
<p>Called as a result of <code>user:learn</code> being invoked. <code>skill</code> IDs are defined in the database table <code>skills</code>. A certain
number of <code>actionPoints</code> were spent on an action, resulting in learning. The learned skill cannot exceed both
<code>learnLimit</code> and <code>100</code>.</p>
<h3 id='reducemc-character-user'><code>reduceMC(Character user)</code></h3>
<p>Called every 10s for every online player. Use this to reduce mental capacity with <code>user:increaseMentalCapacity</code>. A 
higher mental capacity value makes learning more difficult.</p>
<h2 id='login'>Login</h2>
<blockquote>
<p>Login script with all available entry points</p>
</blockquote>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">M</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">onLogin</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">return</span> <span class="n">M</span>
</code></pre></div>
<p><strong>Script file:</strong> <code>server/login.lua</code></p>
<h3 id='onlogin-character-user'><code>onLogin(Character user)</code></h3>
<p>Invoked when <code>user</code> logs in. Here you can display login information, tax players, etc.</p>
<h2 id='logout'>Logout</h2>
<blockquote>
<p>Logout script with all available entry points</p>
</blockquote>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">M</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">onLogout</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">return</span> <span class="n">M</span>
</code></pre></div>
<p><strong>Script file:</strong> <code>server/logout.lua</code></p>
<h3 id='onlogout-character-user'><code>onLogout(Character user)</code></h3>
<p>Invoked when <code>user</code> logs out. Here you can e.g. substitute player faction leaders with their NPC equivalent.</p>
<h2 id='long-time-effects'>Long Time Effects</h2>
<p><a href="#long-time-effect">Long time effects</a> (LTE) allow you to influence a character over a period of time. Their state is
saved whenever the character is saved. They consist of:</p>

<ul>
<li>ID and name </li>
<li>a script defining the LTE</li>
<li>a counter tracking how often an effect had been called already</li>
<li>a variable controlling when the effect will be called again</li>
<li>several user-defined variables accessible by a key string and holding integers</li>
</ul>

<p>After adding an LTE to the database, you can add it to a character, e.g. inside an item script. How the effect works has
to be defined in its script. Every time the LTE is called, the entry point <code>callEffect</code> is invoked. There you can change
the character&#39;s attributes etc. Note that you should always save any changes of fixed attributes in LTE variables, so
you can restore everything when the LTE ends. When a character logs out, all LTE variables are saved. When it logs in
again, the entry point <code>loadEffect</code> is invoked. Any temporary changes of attributes will be lost on logout, so here you
can read the values you have saved and perform those changes again.</p>

<blockquote>
<p>SQL</p>
</blockquote>
<div class="highlight"><pre class="highlight sql tab-sql"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">longtimeeffects</span> <span class="k">VALUES</span> <span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="s1">'EFFECT_NAME'</span><span class="p">,</span> <span class="s1">'SCRIPT_NAME'</span><span class="p">);</span>
</code></pre></div>
<blockquote>
<p>LTE script with all available entry points</p>
</blockquote>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">M</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">addEffect</span><span class="p">(</span><span class="n">effect</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
    <span class="n">user</span><span class="p">:</span><span class="n">inform</span><span class="p">(</span><span class="s2">"added "</span> <span class="o">..</span> <span class="n">effect</span><span class="p">.</span><span class="n">effectName</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">callEffect</span><span class="p">(</span><span class="n">effect</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
    <span class="n">user</span><span class="p">:</span><span class="n">inform</span><span class="p">(</span><span class="s2">"called "</span> <span class="o">..</span> <span class="n">effect</span><span class="p">.</span><span class="n">effectName</span> <span class="o">..</span> <span class="s2">", next: "</span> <span class="o">..</span> <span class="n">effect</span><span class="p">.</span><span class="n">nextCalled</span> <span class="o">..</span> <span class="s2">", called before: "</span> <span class="o">..</span> <span class="n">effect</span><span class="p">.</span><span class="n">numberCalled</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">doubleEffect</span><span class="p">(</span><span class="n">effect</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
    <span class="n">user</span><span class="p">:</span><span class="n">inform</span><span class="p">(</span><span class="s2">"doubled "</span> <span class="o">..</span> <span class="n">effect</span><span class="p">.</span><span class="n">effectName</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">loadEffect</span><span class="p">(</span><span class="n">effect</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
    <span class="n">user</span><span class="p">:</span><span class="n">inform</span><span class="p">(</span><span class="s2">"loaded "</span> <span class="o">..</span> <span class="n">effect</span><span class="p">.</span><span class="n">effectName</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">removeEffect</span><span class="p">(</span><span class="n">effect</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
    <span class="n">user</span><span class="p">:</span><span class="n">inform</span><span class="p">(</span><span class="s2">"removed "</span> <span class="o">..</span> <span class="n">effect</span><span class="p">.</span><span class="n">effectName</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">return</span> <span class="n">M</span>
</code></pre></div>
<p><strong>Database table:</strong> <code>longtimeeffects</code></p>
<h3 id='addeffect-longtimeeffect-effect-character-user'><code>addEffect(LongTimeEffect effect, Character user)</code></h3>
<p>A new <code>effect</code> has been added to <code>user</code>.</p>
<h3 id='bool-calleffect-longtimeeffect-effect-character-user'><code>bool callEffect(LongTimeEffect effect, Character user)</code></h3>
<p>An <code>effect</code> activates for <code>user</code>. If <code>true</code> is returned, the effect will be called again in <code>effect.nextCalled</code>
deciseconds. If <code>false</code> is returned, the effect will be removed.</p>
<h3 id='doubleeffect-longtimeeffect-effect-character-user'><code>doubleEffect(LongTimeEffect effect, Character user)</code></h3>
<p>A script tried to add an effect to <code>user</code>, but <code>effect</code> which has the same id, was already present. This can be used
e.g. to refresh the overall duration of <code>effect</code>, by modifying a variable which stores the number of
times the effect needs to be called.</p>
<h3 id='loadeffect-longtimeeffect-effect-character-user'><code>loadEffect(LongTimeEffect effect, Character user)</code></h3>
<p>A <code>user</code> has logged into the game afflicted by <code>effect</code>. Temporary changes need to be recreated here.</p>
<h3 id='removeeffect-longtimeeffect-effect-character-user'><code>removeEffect(LongTimeEffect effect, Character user)</code></h3>
<p>An <code>effect</code> was removed from <code>user</code> either by returning <code>false</code> in <code>callEffect</code> or by calling
<code>user.effects:removeEffect(id)</code>.</p>
<h2 id='monsters'>Monsters</h2>
<p><strong>function onDeath(monster)</strong></p>

<p>Invoked as a monster dies.</p>

<p><strong>function receiveText(monster, textType, text, originator)</strong></p>

<p>Invoked when a monster receives spoken text.</p>

<p><strong>function onAttacked(monster, attacker)</strong></p>

<p>Invoked when a monster is attacked.</p>

<p><strong>function onCasted(monster, caster)</strong></p>

<p>Invoked when a spell is cast on a monster.</p>

<p><strong>function useMonster(monster, user)</strong></p>

<p>Invoked when a monster is used by user.</p>

<p><strong>function onAttack(monster, enemy)</strong></p>

<p>Invoked every time a monster would hit the enemy.</p>

<p><strong>function enemyOnSight(monster, enemy)</strong></p>

<p>Invoked whenever a monster sees an enemy. </p>

<p>Must return true or false.</p>

<p>It is not invoked when the monster stands on a field next to the enemy.</p>

<p><strong>function enemyNear(monster, enemy)</strong></p>

<p>Same as enemyOnSight but when the monster is on the field next to it.</p>

<p>If you plan to have setTarget(...) return 0 (&quot;don&#39;t attack anyone&quot;), then enemyNear(...) must return false.</p>

<p><strong>function lookAtMonster(SourceCharacter, monster, mode)</strong></p>

<p>Invoked if the player looks at the monster.</p>

<p>Modes:</p>

<p>0 = normal</p>

<p>1 = close examination</p>

<p><strong>function onSpawn(monster)</strong></p>

<p>Invoked after the monster has spawned.</p>

<p><strong>function setTarget(monster, candidateList)</strong></p>

<p>If setTarget exists, it is called whenever the monster needs to decide what it should attack.</p>

<p>The candidateList is a list of players who are possible targets. </p>

<p>To set a target, its index in that list has to be returned. </p>

<p>The first enemy in the list has the index 1. </p>

<p>If the function returns 0, the monster will ignore any enemy. </p>

<p>If setTarget does not exist, the player with lowest health is chosen by default.</p>
<h2 id='npcs'>NPCs</h2><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">M</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">nextCycle</span> <span class="p">(</span><span class="n">npc</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">receiveText</span><span class="p">(</span><span class="n">npc</span><span class="p">)</span>
<span class="k">end</span>
<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">useNPC</span><span class="p">(</span><span class="n">npc</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
    <span class="c1">-- What should happen when you use the npc</span>
<span class="k">end</span>
<span class="n">lookAtNpc</span><span class="p">(</span><span class="n">npc</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
    <span class="c1">-- The lookat for the npc (Not in use? Found no existing examples)</span>
<span class="k">return</span> <span class="n">M</span>
</code></pre></div>
<p>nextCycle (npc)
    Invoked every few server cycles.
    Must exist in NPC scripts.
receiveText(npc)
    Invoked anytime the NPC hears someone speaking.
useNPC(npc, user)
    Invoked when the user shift clicks the NPC.
lookAtNpc(npc, player, mode)
    Invoked if the player looks at the NPC.
    Modes: 0 for normal, 1 for close examination.</p>
<h2 id='player-inspection'>Player Inspection</h2>
<blockquote>
<p>Player inspection script with all available entry points</p>
</blockquote>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">M</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">lookAtPlayer</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">targetPlayer</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">return</span> <span class="n">M</span>
</code></pre></div>
<p><strong>Script file:</strong> <code>server/playerlookat.lua</code></p>
<h3 id='lookatplayer-character-user-character-targetplayer-number-mode'><code>lookAtPlayer(Character user, Character targetPlayer, number mode)</code></h3>
<p>Is invoked when <code>user</code> looks at <code>targetPlayer</code>. For normal inspection <code>mode</code> is 0, for close examination <code>mode</code> is 1.</p>
<h2 id='quests'>Quests</h2><div class="highlight"><pre class="highlight sql tab-sql"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">quests</span> <span class="k">VALUES</span> <span class="p">(</span><span class="n">QUEST_ID</span><span class="p">,</span> <span class="s1">'QUEST_SCRIPT'</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">common</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"base.common"</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">M</span> <span class="o">=</span> <span class="p">{}</span>

<span class="kd">local</span> <span class="n">GERMAN</span> <span class="o">=</span> <span class="n">Player</span><span class="p">.</span><span class="n">german</span>
<span class="kd">local</span> <span class="n">ENGLISH</span> <span class="o">=</span> <span class="n">Player</span><span class="p">.</span><span class="n">english</span>

<span class="kd">local</span> <span class="n">title</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">title</span><span class="p">[</span><span class="n">GERMAN</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Deutscher Questtitel"</span>
<span class="n">title</span><span class="p">[</span><span class="n">ENGLISH</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"English Quest Title"</span>

<span class="kd">local</span> <span class="n">description</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">description</span><span class="p">[</span><span class="n">GERMAN</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">description</span><span class="p">[</span><span class="n">ENGLISH</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">description</span><span class="p">[</span><span class="n">GERMAN</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Tolle lange Beschreibung die angezeigt wird wenn man Queststatus 1 erreicht, \z
                          auch was man wo machen muss ..."</span>
<span class="n">description</span><span class="p">[</span><span class="n">ENGLISH</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Cool long description which is displayed when you reach quest status 1, \z
                           also mention what to do where ..."</span>

<span class="kd">local</span> <span class="n">start</span> <span class="o">=</span> <span class="n">position</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">questTarget</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">questTarget</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">position</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">position</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)}</span>

<span class="kd">local</span> <span class="n">FINAL_QUEST_STATUS</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">QuestTitle</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">common</span><span class="p">.</span><span class="n">GetNLS</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">title</span><span class="p">[</span><span class="n">GERMAN</span><span class="p">],</span> <span class="n">title</span><span class="p">[</span><span class="n">ENGLISH</span><span class="p">])</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">QuestDescription</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">german</span> <span class="o">=</span> <span class="n">description</span><span class="p">[</span><span class="n">GERMAN</span><span class="p">][</span><span class="n">status</span><span class="p">]</span> <span class="ow">or</span> <span class="s2">""</span>
    <span class="kd">local</span> <span class="n">english</span> <span class="o">=</span> <span class="n">description</span><span class="p">[</span><span class="n">ENGLISH</span><span class="p">][</span><span class="n">status</span><span class="p">]</span> <span class="ow">or</span> <span class="s2">""</span>

    <span class="k">return</span> <span class="n">common</span><span class="p">.</span><span class="n">GetNLS</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">german</span><span class="p">,</span> <span class="n">english</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">QuestAvailability</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
        <span class="k">return</span> <span class="n">Player</span><span class="p">.</span><span class="n">questAvailable</span>
    <span class="k">else</span>
        <span class="k">return</span> <span class="n">Player</span><span class="p">.</span><span class="n">questNotAvailable</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">QuestStart</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">start</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">QuestTargets</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">questTarget</span><span class="p">[</span><span class="n">status</span><span class="p">]</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">QuestFinalStatus</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">FINAL_QUEST_STATUS</span>
<span class="k">end</span>

<span class="k">return</span> <span class="n">M</span>
</code></pre></div>
<blockquote>
<p>A more extensive template is available in <code>quest/quest.template</code></p>
</blockquote>

<p>While you can create quests with <code>setQuestProgress</code> and <code>getQuestProgress</code> alone, it is nice to have an actual
log of your quest progress in your client. This way you cannot forget about your quests and you always
know what to do and where to do it. The client might even point you in the right direction. The entrypoints in this
section implement that behaviour.</p>

<p><strong>Database Table:</strong> <code>quests</code></p>

<p>Quest scripts must be entered into the database for the functions to be applied to the associated quest.</p>

<table><thead>
<tr>
<th>qst_id</th>
<th>qst_script</th>
</tr>
</thead><tbody>
<tr>
<td>603</td>
<td>quest.nobarg_603</td>
</tr>
</tbody></table>

<p>The example above is for a quest associated with the npc nobarg, with the quest id 603. In the <code>qst_id</code> entry is the id
assigned to the quest. In the <code>qst_script</code> entry is the folder the script is in (quest) and the name of the .lua file
(nobarg_603).</p>
<h3 id='string-questtitle-character-user'><code>string QuestTitle(Character user)</code></h3>
<p>You should return the quest title here, depending on user language.</p>
<h3 id='string-questdescription-character-user-number-status'><code>string QuestDescription(Character user, number status)</code></h3>
<p>You should return the quest description here, depending on user language and quest status.
You can be as extensive as you want, but make sure to cover the most important points. A
good description should serve as a reminder where to go to complete the next step of the
quest. Let the player know how to get there and what to do there. Imagine a player continuing
a quest after some time, they still need to know where they are at and how to go on.</p>
<h3 id='position-queststart'><code>position QuestStart()</code></h3>
<p>Return the position where the quest begins. This will probably be the position of an NPC or item.</p>
<h3 id='number-questavailability-character-user-number-status'><code>number QuestAvailability(Character user, number status)</code></h3>
<p>You can return three possible values here, depending on the <code>user</code> and the current quest <code>status</code>:</p>

<ul>
<li><code>Player.questAvailable</code>: yellow quest marker &quot;!&quot;</li>
<li><code>Player.questWillBeAvailable</code>: grey quest marker &quot;!&quot;</li>
<li><code>Player.questNotAvailable</code>: no quest marker</li>
</ul>

<p>If the quest could be available soon (e.g. missing skill) return <code>Player.questWillBeAvailable</code>
and if the player tries to accept the quest, inform them what exactly is missing to do so.
If the quest will not be available (wrong town, too much skill already, etc.) return
<code>Player.questNotAvailable</code>.</p>

<p>If this entry point is not defined, the server will assume <code>Player.questAvailable</code> for <code>status == 0</code>
and <code>Player.questNotAvailable</code> otherwise.</p>
<h3 id='list-position-questtargets-character-user-number-status'><code>list|position QuestTargets(Character user, number status)</code></h3>
<p>Here you should return the position where the quest continues, i.e. where a new quest status
can be obtained. The client will receive this position and direct the player towards it. You
can also return nil or an empty list if no such positions should be displayed in the client.
Omit positions with care. Even if you think it would be cool to let players search on their
own, most of the time it is just annoying. You can also return a list of positions here if the
quest can continue in more than one location.</p>
<h3 id='number-questfinalstatus'><code>number QuestFinalStatus()</code></h3>
<p>Return the final status of your quest here. This is used by the server to determine whether the
end of a quest has been reached. If so, the client is notified to display the quest as completed.</p>
<h2 id='reloading-scripts'>Reloading Scripts</h2>
<blockquote>
<p>Reload script with all available entry points</p>
</blockquote>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">M</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">onReload</span><span class="p">()</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="k">end</span>

<span class="k">return</span> <span class="n">M</span>
</code></pre></div>
<p><strong>Script file:</strong> <code>server/reload.lua</code></p>
<h3 id='boolean-onreload'><code>boolean onReload()</code></h3>
<p>Invoked after server start as well as after the <code>!fr</code> command has been issued in the client. Needs to return <code>true</code> for
the reload to succeed. If <code>false</code> is returned, the reload will fail. You can use this for initialising code that would
otherwise not run on reload.</p>

<p>Most of the time any initialisation should be performed in a related script, though. The server will run all scripts
entered into the database as well as all server scripts on every reload and server start. Keep in mind that you <em>can</em>
put code in a file outside of any function and it will be run at those times.</p>
<h2 id='scheduled'>Scheduled</h2><div class="highlight"><pre class="highlight sql tab-sql"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">scheduledscripts</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'SCRIPT_NAME'</span><span class="p">,</span> <span class="n">MIN_TIME</span><span class="p">,</span> <span class="n">MAX_TIME</span><span class="p">,</span> <span class="s1">'myScheduledFunction'</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">M</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">myScheduledFunction</span><span class="p">()</span>
    <span class="c1">-- What I want my scheduled function to do</span>
<span class="k">end</span>

<span class="k">return</span> <span class="n">M</span>
</code></pre></div>
<p><strong>Database Table:</strong> <code>scheduledscripts</code></p>

<p>Scripts can be scheduled to be executed at defined intervals by entering them into the database.</p>

<p>You need the following information:</p>

<p><strong>Script name</strong></p>

<p>The name of the script file.</p>

<p><strong>Minimum Cycle Time</strong></p>

<p>The minimum time between each function call in seconds.</p>

<p><strong>Maximum Cycle Time</strong></p>

<p>The maximum time between each function call in seconds. Can be set to the same as minimum time to have no randomness.</p>

<p><strong>Function Name</strong></p>

<p>The name of the function you want to run.</p>

<p><strong>Database entry example:</strong></p>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">M</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">informUsers</span><span class="p">()</span>
    <span class="n">world</span><span class="p">:</span><span class="n">broadcast</span><span class="p">(</span><span class="s2">"German Text"</span><span class="p">,</span><span class="s2">"English Text"</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">return</span> <span class="n">M</span>
</code></pre></div>
<table><thead>
<tr>
<th>sc_scriptname</th>
<th>sc_mincycletime</th>
<th>sc_maxcycletime</th>
<th>sc_functionname</th>
</tr>
</thead><tbody>
<tr>
<td>scheduled.myScript</td>
<td>10</td>
<td>15</td>
<td>informUsers</td>
</tr>
</tbody></table>

<p>The above database entry will make it so that the function <code>informUsers</code> found in the Lua script
<code>myScheduledScript.lua</code> in the folder named <code>scheduled</code> is run every 10 to 15 seconds. In this case it is broadcasting
the given text to all players.</p>
<h1 id='classes'>Classes</h1><h2 id='character'>Character</h2>
<p>Players, NPCs and monsters are the three types of characters in Illarion.</p>

<p><img src="images/directions-a05aa5a6.png" alt="directions" /></p>
<h3 id='variables'>Variables</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Writable</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>number</td>
<td>no</td>
<td>character id</td>
</tr>
<tr>
<td>effects</td>
<td>userdata</td>
<td>no</td>
<td>contains methods to control the character&#39;s long time effects, see section on long time effects.</td>
</tr>
<tr>
<td>name</td>
<td>text</td>
<td>no</td>
<td>character name</td>
</tr>
<tr>
<td>pos</td>
<td>position</td>
<td>no</td>
<td>character position on world map</td>
</tr>
<tr>
<td>lastSpokenText</td>
<td>text</td>
<td>no</td>
<td>character&#39;s last spoken line of text</td>
</tr>
<tr>
<td>attackmode</td>
<td>boolean</td>
<td>no</td>
<td><code>true</code> if character currently attacks, <code>false</code> otherwise</td>
</tr>
<tr>
<td>activeLanguage</td>
<td>number</td>
<td>yes</td>
<td>0: common, 1: human, 2: dwarf, 3: elf, 4: lizard, 5: orc, 6: halfling, 7: fairy, 8: gnome, 9: goblin, 10: ancient</td>
</tr>
<tr>
<td>movepoints</td>
<td>number</td>
<td>yes</td>
<td>A character has a maximum of 21 movepoints. Every action like talking, fighting, using etc. needs at least 7 movepoints. The reduction of movepoints depends on the character&#39;s agility. A character gains one movepoint per decisecond.</td>
</tr>
</tbody></table>
<h3 id='actions'>Actions</h3><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">M</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">UseItem</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">actionState</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">gfxRain</span> <span class="o">=</span> <span class="mi">16</span>

    <span class="k">if</span> <span class="n">actionState</span> <span class="o">==</span> <span class="n">Action</span><span class="p">.</span><span class="n">none</span> <span class="k">then</span>
        <span class="n">user</span><span class="p">:</span><span class="n">startAction</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">gfxRain</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">user</span><span class="p">:</span><span class="n">inform</span><span class="p">(</span><span class="s2">"start"</span><span class="p">)</span>
        <span class="n">item</span><span class="p">.</span><span class="n">number</span> <span class="o">=</span> <span class="n">item</span><span class="p">.</span><span class="n">number</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">world</span><span class="p">:</span><span class="n">changeItem</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">user</span><span class="p">:</span><span class="n">changeSource</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">elseif</span> <span class="n">actionState</span> <span class="o">==</span> <span class="n">Action</span><span class="p">.</span><span class="n">abort</span> <span class="k">then</span>
        <span class="n">user</span><span class="p">:</span><span class="n">inform</span><span class="p">(</span><span class="s2">"abort: "</span> <span class="o">..</span> <span class="n">item</span><span class="p">.</span><span class="n">number</span><span class="p">)</span>
    <span class="k">elseif</span> <span class="n">actionState</span> <span class="o">==</span> <span class="n">Action</span><span class="p">.</span><span class="n">success</span> <span class="k">then</span>
        <span class="n">user</span><span class="p">:</span><span class="n">inform</span><span class="p">(</span><span class="s2">"success: "</span> <span class="o">..</span> <span class="n">item</span><span class="p">.</span><span class="n">number</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">actionDisturbed</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">attacker</span><span class="p">)</span>
    <span class="n">user</span><span class="p">:</span><span class="n">inform</span><span class="p">(</span><span class="s2">"disturbed by "</span> <span class="o">..</span> <span class="n">attacker</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="k">end</span>

<span class="k">return</span> <span class="n">M</span>
</code></pre></div>
<p>All Use* entry points (e.g. UseItem) which have an <code>actionState</code> parameter, allow for starting actions. An action can be
seen as a state of concentration of the user, which lasts for a specified time. After that time or when the action is
interrupted, the entry point is called again with the same parameters, but with actionState set to <code>Action.abort</code> or
<code>Action.success</code> accordingly. Usually actions are aborted by the user doing something else, like using something,
moving, etc. However, actions can also be aborted by the user being attacked if an <code>actionDisturbed</code> entry point is
defined and returns <code>true</code>.</p>
<h4 id='startaction-number-duration-number-gfxid-number-gfxinterval-number-sfxid-number-sfxinterval'><code>startAction(number duration, number gfxId, number gfxInterval, number sfxId, number sfxInterval)</code></h4>
<p>Starts an action lasting <code>duration</code> deciseconds. At the start of the action and every <code>gfxInterval</code> deciseconds after
that <a href="https://illarion.org/~devserver/effects/effects.html">graphic effect</a> <code>gfxId</code> is played.
Similarly, at the start of the action and every <code>sfxInterval</code> deciseconds after
that <a href="https://illarion.org/~devserver/sounds/sounds.html">sound effect</a> <code>sfxId</code> is played. If <code>gfxId</code> or <code>sfxId</code> are set
to <code>0</code>, no effect of that type will be played.</p>
<h4 id='changesource-item-item'><code>changeSource(Item item)</code></h4>
<p>If you modify the <code>item</code> associated with an action started in <code>UseItem</code>, this functions ensures the next time
<code>UseItem</code> is called by the action (when it succeeds or is aborted) the updated item will be provided as a parameter.
This needs to be called in addition to <code>world:changeItem</code>.</p>
<h3 id='long-time-effects'>Long Time Effects</h3>
<p>See class <a href="#long-time-effect">LongTimeEffect</a> for details.</p>
<h4 id='effects-addeffect-longtimeeffect-effect'><code>effects:addEffect(LongTimeEffect effect)</code></h4><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">effect</span> <span class="o">=</span> <span class="n">LongTimeEffect</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">user</span><span class="p">.</span><span class="n">effects</span><span class="p">:</span><span class="n">addEffect</span><span class="p">(</span><span class="n">effect</span><span class="p">)</span>
</code></pre></div>
<p>Tries to add <code>effect</code> to the character. <a href="#long-time-effects">Entry point</a> <code>addEffect</code> is called immediately if the
effect is not yet present on the character. Otherwise entry point <code>doubleEffect</code> is called.</p>
<h4 id='boolean-longtimeeffect-effects-find-number-id'><code>boolean, LongTimeEffect effects.find(number id)</code></h4><h4 id='boolean-longtimeeffect-effects-find-string-name'><code>boolean, LongTimeEffect effects.find(string name)</code></h4><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">found</span><span class="p">,</span> <span class="n">effect</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">effects</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">"some effect"</span><span class="p">)</span>
</code></pre></div>
<p>Searches for a long time effect by <code>id</code> or <code>name</code> and returns <code>true</code> and that effect if it exists on this character.
Returns <code>false</code> if that effect does not exist on this character.</p>
<h4 id='boolean-effects-removeeffect-number-id'><code>boolean effects:removeEffect(number id)</code></h4><h4 id='boolean-effects-removeeffect-string-name'><code>boolean effects:removeEffect(string name)</code></h4><h4 id='boolean-effects-removeeffect-longtimeeffect-effect'><code>boolean effects:removeEffect(LongTimeEffect effect)</code></h4><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">removed</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">effects</span><span class="p">:</span><span class="n">removeEffect</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>
<p>Removes an effect from this character, either by <code>id</code>, by <code>name</code> or by passing the <code>effect</code> itself. Returns <code>true</code> if an
effect was removed and <code>false</code> otherwise.</p>
<h3 id='text-speech-functions'>Text/Speech Functions</h3><h4 id='talk-number-mode-text-message'><code>talk(number mode, text message)</code></h4><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="n">user</span><span class="p">:</span><span class="n">talk</span><span class="p">(</span><span class="n">Character</span><span class="p">.</span><span class="n">say</span><span class="p">,</span> <span class="s2">"Hello World!"</span><span class="p">)</span>
</code></pre></div>
<p>Lets a character say/whisper/yell a <code>message</code>. <code>mode</code> can be <code>Character.say</code>, <code>Character.whisper</code> or <code>Character.yell</code>.</p>
<h2 id='colour'>colour</h2>
<p>Colours are used to represent a characters skin or hair colour.</p>
<h3 id='variables'>Variables</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Writable</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>red</td>
<td>number</td>
<td>yes</td>
<td>From 0 (no red) to 255 (full red)</td>
</tr>
<tr>
<td>green</td>
<td>number</td>
<td>yes</td>
<td>From 0 (no green) to 255 (full green)</td>
</tr>
<tr>
<td>blue</td>
<td>number</td>
<td>yes</td>
<td>From 0 (no blue) to 255 (full blue)</td>
</tr>
<tr>
<td>alpha</td>
<td>number</td>
<td>yes</td>
<td>From 0 (transparent) to 255 (opaque)</td>
</tr>
</tbody></table>
<h3 id='functions'>Functions</h3><h4 id='colour-number-red-number-green-number-blue-number-alpha-255'><code>colour(number red, number green, number blue [, number alpha = 255])</code></h4><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">black</span> <span class="o">=</span> <span class="n">colour</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div>
<p>Creates colour for given RGBA values.</p>
<h2 id='dialogs'>Dialogs</h2>
<p>Dialogs are a more sophisticated approach to aquire user input than e.g. <code>user.lastSpokenText</code>. Each dialog serves a
specific purpose like displaying bulk text, interfacing with a merchant or with the crafting system. Dialogs should be
the preferred method for handling user input. If necessary new types should be implemented rather than abusing old
variants or falling back to <code>lastSpokenText</code>. Please note, that as with many functions dialogs work with all types of
characters (players, monsters, npcs) but only make sense with players. Using the other two types will work but do
nothing at all. Using a dialog always consists of three descrete steps:</p>

<ol>
<li>Create a callback function to be triggered automatically when the user closes the dialog. This function has to have a
single parameter to which the dialog will be passed with obtained results.</li>
<li>Invoke the constructor of a specific dialog to create a dialog instance, passing required parameters and callback.</li>
<li>Have a player object request the dialog in the user&#39;s client. Script execution does not stop after this request. The
callback with results is called whenever the user closes the dialog.</li>
</ol>

<p>Usually, creating an object would be described before talking about results. However, here we chose a different order to
follow the three steps mentioned above, which reflect the order in which you would write a dialog, and to review the
most interesting details first, namely what each dialog actually contributes to a particular script.</p>
<h3 id='messagedialog'>MessageDialog</h3>
<p>Use this dialog to display bulk text in an on-screen window. The user can close the window at any time.</p>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">callback</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">dialog</span><span class="p">)</span>
    <span class="n">user</span><span class="p">:</span><span class="n">inform</span><span class="p">(</span><span class="s2">"Dialog closed"</span><span class="p">)</span>
<span class="k">end</span>

<span class="kd">local</span> <span class="n">lyrics</span> <span class="o">=</span> <span class="s">[[
O Fortuna
Velut luna
Statu variabilis
...
]]</span>

<span class="kd">local</span> <span class="n">dialog</span> <span class="o">=</span> <span class="n">MessageDialog</span><span class="p">(</span><span class="s2">"O Fortuna"</span><span class="p">,</span> <span class="n">lyrics</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
<span class="n">user</span><span class="p">:</span><span class="n">requestMessageDialog</span><span class="p">(</span><span class="n">dialog</span><span class="p">)</span>
</code></pre></div><h4 id='results'>Results</h4>
<p>This type of dialog by it&#39;s very nature has no results to be accessed. Still a callback makes sense, because you might
want to react to the dialog being closed.</p>
<h4 id='construction'>Construction</h4><h5 id='messagedialog-string-title-string-message-function-callback'><code>MessageDialog(string title, string message, function callback)</code></h5>
<p>Creates a MessageDialog with a specific <code>title</code> and <code>message</code>.</p>
<h4 id='request'>Request</h4><h5 id='user-requestmessagedialog-messagedialog-dialog'><code>user:requestMessageDialog(MessageDialog dialog)</code></h5><h3 id='inputdialog'>InputDialog</h3>
<p>This dialog requests text input from the user. If you want to further restrict the input, make that clear to the user
using the description and enforce it inside the callback. For different kinds of input (e.g. items) use or request
development of a different type of dialog.</p>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">callback</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">dialog</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dialog</span><span class="p">:</span><span class="n">getSuccess</span><span class="p">()</span> <span class="k">then</span>
        <span class="n">user</span><span class="p">:</span><span class="n">inform</span><span class="p">(</span><span class="s2">"You canceled! How dare you?"</span><span class="p">)</span>
    <span class="k">else</span>
        <span class="n">user</span><span class="p">:</span><span class="n">inform</span><span class="p">(</span><span class="s2">"You wrote: "</span> <span class="o">..</span> <span class="n">dialog</span><span class="p">:</span><span class="n">getInput</span><span class="p">())</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="kd">local</span> <span class="n">dialog</span> <span class="o">=</span> <span class="n">InputDialog</span><span class="p">(</span><span class="s2">"Insert some text!"</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
<span class="n">user</span><span class="p">:</span><span class="n">requestInputDialog</span><span class="p">(</span><span class="n">dialog</span><span class="p">)</span>
</code></pre></div><h4 id='results'>Results</h4><h5 id='boolean-getsuccess'><code>boolean getSuccess()</code></h5>
<p>The result is <code>true</code> if the dialog was confirmed and <code>false</code> if it was aborted.</p>
<h5 id='string-getinput'><code>string getInput()</code></h5>
<p>Returns the user&#39;s input if the dialog was successful. The return value is undefined if the dialog was aborted.</p>
<h4 id='construction'>Construction</h4><h5 id='inputdialog-string-title-string-description-boolean-multiline-number-maxchars-function-callback'><code>InputDialog(string title, string description, boolean multiline, number maxChars, function callback)</code></h5>
<p>Creates an InputDialog with <code>title</code> and <code>description</code>. It allows line breaks iff <code>multiline</code> is set to <code>true</code>.
The input can be up to <code>maxChars</code> characters long.</p>
<h4 id='request'>Request</h4><h5 id='user-requestinputdialog-inputdialog-dialog'><code>user:requestInputDialog(InputDialog dialog)</code></h5><h2 id='field'>Field</h2>
<p>Fields make up the game map. Characters stand on fields, items are on fields, warps make players jump from
one field to another. Each field is on a different logical <code>position</code>.</p>
<h3 id='functions'>Functions</h3>
<p>Most of the time these functions will be used on a field received from <code>world:getField(position)</code>.</p>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">doorPosition</span> <span class="o">=</span> <span class="n">position</span><span class="p">(</span><span class="mi">261</span><span class="p">,</span> <span class="mi">631</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">doorField</span> <span class="o">=</span> <span class="n">world</span><span class="p">:</span><span class="n">getField</span><span class="p">(</span><span class="n">doorPosition</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">groundId</span> <span class="o">=</span> <span class="n">doorField</span><span class="p">:</span><span class="n">tile</span><span class="p">()</span>
</code></pre></div><h4 id='number-tile'><code>number tile()</code></h4>
<p>Returns the tile id of that field, meaning the number for &quot;water&quot;, &quot;grass&quot;, etc.</p>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">itemsOnField</span> <span class="o">=</span> <span class="n">field</span><span class="p">:</span><span class="n">countItems</span><span class="p">()</span>
</code></pre></div><h4 id='number-countitems'><code>number countItems()</code></h4>
<p>Returns the number of items on top of that field.</p>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">topItem</span> <span class="o">=</span> <span class="n">field</span><span class="p">:</span><span class="n">getStackItem</span><span class="p">(</span><span class="n">itemsOnField</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div><h4 id='item-getstackitem-number-stackposition'><code>Item getStackItem(number stackPosition)</code></h4>
<p>Returns the item at <code>stackPosition</code> on a given field. <code>stackPosition == 0</code> will return the bottom item.
If <code>stackPosition</code> is equal or greater than the number of items on that field, an item with id <code>0</code> will be returned.</p>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">dropPossible</span> <span class="o">=</span> <span class="n">field</span><span class="p">:</span><span class="n">isPassable</span><span class="p">()</span>
</code></pre></div><h4 id='boolean-ispassable'><code>boolean isPassable()</code></h4>
<p>Determines whether or not a field allows a character to pass over it or having items dropped on it.</p>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">hasWarp</span><span class="p">,</span> <span class="n">warp</span> <span class="o">=</span> <span class="n">field</span><span class="p">:</span><span class="n">isWarp</span><span class="p">()</span>
</code></pre></div><h4 id='boolean-position-iswarp'><code>boolean, position isWarp()</code></h4>
<p>Returns whether or not a field is a warp as well as the warp destination.</p>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">exit</span> <span class="o">=</span> <span class="n">position</span> <span class="p">(</span><span class="mi">146</span><span class="p">,</span> <span class="o">-</span><span class="mi">381</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">field</span><span class="p">:</span><span class="n">setWarp</span><span class="p">(</span><span class="n">exit</span><span class="p">)</span>
</code></pre></div><h4 id='setwarp-position-destination'><code>setWarp(position destination)</code></h4>
<p>Enables the field&#39;s warp and sets its <code>destination</code>.</p>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="n">field</span><span class="p">:</span><span class="n">removeWarp</span><span class="p">()</span>
</code></pre></div><h4 id='removewarp'><code>removeWarp()</code></h4>
<p>Removes the field&#39;s warp.</p>
<h2 id='item'>Item</h2><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="n">item</span><span class="p">.</span><span class="n">quality</span> <span class="o">=</span> <span class="mi">284</span>
<span class="n">item</span><span class="p">.</span><span class="n">setData</span><span class="p">(</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"John's Item"</span><span class="p">)</span>
<span class="n">world</span><span class="p">:</span><span class="n">changeItem</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</code></pre></div>
<p>Represents an actual item on the map or in a character&#39;s pockets. If you change an <code>item</code>, you need to propagate your
changes to the server via <code>world:changeItem(item)</code>.</p>
<h3 id='constants'>Constants</h3><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">itemStats</span> <span class="o">=</span> <span class="n">world</span><span class="p">:</span><span class="n">getItemStatsFromId</span><span class="p">(</span><span class="n">Item</span><span class="p">.</span><span class="n">apple</span><span class="p">)</span>
</code></pre></div>
<p>If an item has an entry <code>someUniqueItemName</code> in <code>itm_name</code> in the item&#39;s database entry, you can get its id with
<code>Item.someUniqueItemName</code>. This is more descriptive than using the actual number.</p>
<h3 id='variables'>Variables</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Writable</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>number</td>
<td>yes</td>
<td>item id</td>
</tr>
<tr>
<td>inside</td>
<td>Container</td>
<td>no</td>
<td>if the item is in a container, this is that container</td>
</tr>
<tr>
<td>itempos</td>
<td>number</td>
<td>no</td>
<td>if the item is in a container or in a character&#39;s inventory, this is its position there</td>
</tr>
<tr>
<td>number</td>
<td>number</td>
<td>yes</td>
<td>number of identical items in the stack</td>
</tr>
<tr>
<td>owner</td>
<td>Character</td>
<td>no</td>
<td>if the item is on a character, this is that character</td>
</tr>
<tr>
<td>pos</td>
<td>position</td>
<td>no</td>
<td>if the item is on the map, this is the position of the field it is on</td>
</tr>
<tr>
<td>quality</td>
<td>number</td>
<td>yes</td>
<td>item quality from 0 to 999, where the first digit is quality and the last two digits are durability</td>
</tr>
<tr>
<td>wear</td>
<td>number</td>
<td>yes</td>
<td>if an item can decay it loses one wear point every three minutes</td>
</tr>
</tbody></table>
<h3 id='functions'>Functions</h3><h4 id='string-getdata-string-key'><code>string getData(string key)</code></h4><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">prayerLevel</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">item</span><span class="p">:</span><span class="n">getData</span><span class="p">(</span><span class="s2">"prayerLevel"</span><span class="p">))</span>
</code></pre></div>
<p>Returns the item&#39;s data value for the given <code>key</code> if that key exists and an empty string otherwise.</p>
<h4 id='number-gettype'><code>number getType()</code></h4><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="k">if</span> <span class="n">item</span><span class="p">:</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="n">scriptItem</span><span class="p">.</span><span class="n">field</span> <span class="k">then</span>
    <span class="n">debug</span><span class="p">(</span><span class="s2">"item with id "</span> <span class="o">..</span> <span class="n">item</span><span class="p">.</span><span class="n">id</span> <span class="o">..</span> <span class="s2">" is on the ground"</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>Depending on where the item is located, will return one of</p>

<ul>
<li><code>scriptItem.notdefined</code></li>
<li><code>scriptItem.field</code></li>
<li><code>scriptItem.inventory</code></li>
<li><code>scriptItem.belt</code></li>
<li><code>scriptItem.container</code></li>
</ul>
<h4 id='boolean-islarge'><code>boolean isLarge()</code></h4><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">blocksView</span> <span class="o">=</span> <span class="n">item</span><span class="p">:</span><span class="n">isLarge</span><span class="p">()</span>
</code></pre></div>
<p>Returns true if and only if the item is large enough to block a character&#39;s view. This means in the database it has a
volume of at least 5000.</p>
<h4 id='setdata-string-key-number-value'><code>setData(string key, number value)</code></h4><h4 id='setdata-string-key-string-value'><code>setData(string key, string value)</code></h4><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="n">item</span><span class="p">:</span><span class="n">setData</span><span class="p">(</span><span class="s2">"prayerLevel"</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">item</span><span class="p">:</span><span class="n">setData</span><span class="p">(</span><span class="s2">"prayerLevel"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
<span class="n">item</span><span class="p">:</span><span class="n">setData</span><span class="p">(</span><span class="s2">"prefix"</span><span class="p">,</span> <span class="s2">"very strong "</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p>The second line removes the data key <code>prayerLevel</code> from the item.</p>
</blockquote>

<p>Sets the data <code>value</code> for a given <code>key</code> unless <code>value</code> is an empty string, in which case the entry for <code>key</code> is removed.
If given a number for <code>value</code>, that number is stored as the corresponding string.</p>
<h2 id='itemlookat'>ItemLookAt</h2>
<p>Holds information about an item which is used by the client to display item inspection pop-ups. It is mainly used in the
<a href="#item-inspection">server entry point</a> <code>lookAtItem</code> and the <a href="#items">Item entry point</a> <code>LookAtItem</code>.</p>
<h3 id='variables'>Variables</h3><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">itemLookAt</span> <span class="o">=</span> <span class="n">ItemLookAt</span><span class="p">()</span>
<span class="n">itemLookAt</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Sword"</span>
<span class="n">itemLookAt</span><span class="p">.</span><span class="n">rareness</span> <span class="o">=</span> <span class="n">ItemLookAt</span><span class="p">.</span><span class="n">uncommonItem</span>
</code></pre></div>
<p>All variables are writable.</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td><code>&quot;&quot;</code></td>
<td>item name, <em>must</em> be set</td>
</tr>
<tr>
<td>rareness</td>
<td>number</td>
<td><code>ItemLookAt.commonItem</code></td>
<td>has to be one of ItemLookAt.commonItem, ItemLookAt.uncommonItem, ItemLookAt.rareItem, ItemLookAt.epicItem</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td><code>&quot;&quot;</code></td>
<td>item description</td>
</tr>
<tr>
<td>craftedBy</td>
<td>string</td>
<td><code>&quot;&quot;</code></td>
<td>who crafted the item</td>
</tr>
<tr>
<td>type</td>
<td>string</td>
<td><code>&quot;&quot;</code></td>
<td>states what kind of item this is</td>
</tr>
<tr>
<td>level</td>
<td>number</td>
<td><code>0</code></td>
<td>item level from 0 to 100</td>
</tr>
<tr>
<td>usable</td>
<td>boolean</td>
<td><code>true</code></td>
<td>can the item be used by players?</td>
</tr>
<tr>
<td>weight</td>
<td>number</td>
<td><code>0</code></td>
<td>item weight</td>
</tr>
<tr>
<td>worth</td>
<td>number</td>
<td><code>0</code></td>
<td>selling price (to NPCs) in copper coins</td>
</tr>
<tr>
<td>qualityText</td>
<td>string</td>
<td><code>&quot;&quot;</code></td>
<td>describing item quality</td>
</tr>
<tr>
<td>durabilityText</td>
<td>string</td>
<td><code>&quot;&quot;</code></td>
<td>describing item durability</td>
</tr>
<tr>
<td>durabilityValue</td>
<td>number</td>
<td><code>0</code></td>
<td>from 0 to 100 in percent</td>
</tr>
<tr>
<td>diamondLevel</td>
<td>number</td>
<td><code>0</code></td>
<td>magic gem level from 0 to 10</td>
</tr>
<tr>
<td>emeraldLevel</td>
<td>number</td>
<td><code>0</code></td>
<td>magic gem level from 0 to 10</td>
</tr>
<tr>
<td>rubyLevel</td>
<td>number</td>
<td><code>0</code></td>
<td>magic gem level from 0 to 10</td>
</tr>
<tr>
<td>sapphireLevel</td>
<td>number</td>
<td><code>0</code></td>
<td>magic gem level from 0 to 10</td>
</tr>
<tr>
<td>amethystLevel</td>
<td>number</td>
<td><code>0</code></td>
<td>magic gem level from 0 to 10</td>
</tr>
<tr>
<td>obsidianLevel</td>
<td>number</td>
<td><code>0</code></td>
<td>magic gem level from 0 to 10</td>
</tr>
<tr>
<td>topazLevel</td>
<td>number</td>
<td><code>0</code></td>
<td>magic gem level from 0 to 10</td>
</tr>
<tr>
<td>bonus</td>
<td>number</td>
<td><code>0</code></td>
<td>gem bonus from 0 to 255</td>
</tr>
</tbody></table>
<h3 id='functions'>Functions</h3><h4 id='itemlookat-2'><code>ItemLookAt()</code></h4>
<p>Returns new ItemLookAt with default values.</p>
<h2 id='itemstruct'>ItemStruct</h2><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">itemStats</span> <span class="o">=</span> <span class="n">world</span><span class="p">:</span><span class="n">getItemStats</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">item</span><span class="p">.</span><span class="n">wear</span> <span class="o">=</span> <span class="n">itemStats</span><span class="p">.</span><span class="n">AgeingSpeed</span>
<span class="n">world</span><span class="p">:</span><span class="n">changeItem</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p>Reset item wear to its default</p>
</blockquote>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">itemStats</span> <span class="o">=</span> <span class="n">world</span><span class="p">:</span><span class="n">getItemStatsFromId</span><span class="p">(</span><span class="n">Item</span><span class="p">.</span><span class="n">apple</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">vendorSellPrice</span> <span class="o">=</span> <span class="n">itemStats</span><span class="p">.</span><span class="n">Worth</span>
<span class="kd">local</span> <span class="n">nameEnglish</span> <span class="o">=</span> <span class="n">itemStats</span><span class="p">.</span><span class="n">English</span>
<span class="kd">local</span> <span class="n">nameGerman</span> <span class="o">=</span> <span class="n">itemStats</span><span class="p">.</span><span class="n">German</span>
</code></pre></div>
<blockquote>
<p>We don&#39;t need an actual item to get this data, the id (Item.apple) is enough.</p>
</blockquote>

<p>Represents item definitions obtained from the database. Does not represent an item on the map or in a player&#39;s inventory,
but general information about an item with a specific id. </p>
<h3 id='variables'>Variables</h3>
<p>All of these variables are read-only.</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>AgeingSpeed</td>
<td>number</td>
<td>item does not decay for 3 * AgeingSpeed minutes, by default</td>
</tr>
<tr>
<td>Brightness</td>
<td>number</td>
<td>from 0 to 9, used for light sources</td>
</tr>
<tr>
<td>BuyStack</td>
<td>number</td>
<td>default stack size on vendors</td>
</tr>
<tr>
<td>English</td>
<td>string</td>
<td>English item name</td>
</tr>
<tr>
<td>EnglishDescription</td>
<td>string</td>
<td>English item description</td>
</tr>
<tr>
<td>German</td>
<td>string</td>
<td>German item name</td>
</tr>
<tr>
<td>GermanDescription</td>
<td>string</td>
<td>German item description</td>
</tr>
<tr>
<td>id</td>
<td>number</td>
<td>item id</td>
</tr>
<tr>
<td>Level</td>
<td>number</td>
<td>item level from 0 to 100</td>
</tr>
<tr>
<td>MaxStack</td>
<td>number</td>
<td>maximum stack size</td>
</tr>
<tr>
<td>ObjectAfterRot</td>
<td>number</td>
<td>item id the item changes into after decaying</td>
</tr>
<tr>
<td>Rareness</td>
<td>number</td>
<td>ItemLookAt.commonItem, ItemLookAt.uncommonItem, ItemLookAt.rareItem or ItemLookAt.epicItem</td>
</tr>
<tr>
<td>rotsInInventory</td>
<td>boolean</td>
<td>if set, item decays in a player&#39;s inventory, useful for e.g. lit torches</td>
</tr>
<tr>
<td>Weight</td>
<td>number</td>
<td>item weight, item can only be moved if its weight is below 30000</td>
</tr>
<tr>
<td>Worth</td>
<td>number</td>
<td>sold by vendors for this amount of copper coins</td>
</tr>
</tbody></table>
<h2 id='long-time-effect'>Long Time Effect</h2>
<p>Stored in a character&#39;s <code>effects</code> variable. See section &quot;Long Time Effects&quot; for <a href="#character">Character</a> on how to access
it. For a description on how to use long time effects, see their <a href="#long-time-effects">entry point</a> section.</p>
<h3 id='variables'>Variables</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Writable</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>effectId</td>
<td>number</td>
<td>no</td>
<td>effect id</td>
</tr>
<tr>
<td>effectName</td>
<td>string</td>
<td>no</td>
<td>effect name</td>
</tr>
<tr>
<td>nextCalled</td>
<td>number</td>
<td>yes</td>
<td>number of deciseconds until the effect should be called</td>
</tr>
<tr>
<td>numberCalled</td>
<td>number</td>
<td>no</td>
<td>number of times the effect has been called before, meaning on the first call this will be zero, etc.</td>
</tr>
</tbody></table>
<h3 id='functions'>Functions</h3><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">effect</span> <span class="o">=</span> <span class="n">LongTimeEffect</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">effect</span><span class="p">:</span><span class="n">addValue</span><span class="p">(</span><span class="s2">"totalCalls"</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">exists</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">effect</span><span class="p">:</span><span class="n">findValue</span><span class="p">(</span><span class="s2">"totalCalls"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">exists</span> <span class="k">then</span>
    <span class="n">effect</span><span class="p">:</span><span class="n">addValue</span><span class="p">(</span><span class="s2">"totalCalls"</span><span class="p">,</span> <span class="n">value</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
<span class="k">else</span>
    <span class="n">effect</span><span class="p">:</span><span class="n">addValue</span><span class="p">(</span><span class="s2">"totalCalls"</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">effect</span><span class="p">:</span><span class="n">removeValue</span><span class="p">(</span><span class="s2">"totalCalls"</span><span class="p">)</span>
</code></pre></div><h4 id='longtimeeffect-number-id-number-nextcalled'><code>LongTimeEffect(number id, number nextCalled)</code></h4>
<p>Returns a new LongTimeEffect with given <code>id</code> and <code>nextCalled</code> being the number of deciseconds until the effect is first
called via entry point <code>callEffect</code> after being added to a character.</p>
<h4 id='addvalue-string-key-number-value'><code>addValue(string key, number value)</code></h4>
<p>Adds or overwrites variable <code>key</code> with value <code>value</code>. <code>value</code> is non-negative and less than 2^32.</p>
<h4 id='boolean-number-findvalue-string-key'><code>boolean, number findValue(string key)</code></h4>
<p>Returns false if the effect has no variable with name <code>key</code>. Otherwise returns <code>true</code> and the value of that variable.</p>
<h4 id='removevalue-string-key'><code>removeValue(string key)</code></h4>
<p>Removes variable with name <code>key</code> from the effect.</p>
<h2 id='position'>position</h2>
<p>Positions represent a location on the world map.</p>
<h3 id='variables'>Variables</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Writable</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>x</td>
<td>number</td>
<td>yes</td>
<td>x coordinate, increases from west to east (lower left to upper right)</td>
</tr>
<tr>
<td>y</td>
<td>number</td>
<td>yes</td>
<td>y coordinate, increases from north to south (upper left to lower right)</td>
</tr>
<tr>
<td>z</td>
<td>number</td>
<td>yes</td>
<td>z coordinate, increases as levels go up</td>
</tr>
</tbody></table>
<h3 id='functions'>Functions</h3><h4 id='position-number-x-number-y-number-z'><code>position(number x, number y, number z)</code></h4><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">position</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div>
<p>Returns position for map location (x, y, z).</p>
<h4 id='position-p1-position-p2'><code>position p1 == position p2</code></h4><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">equal</span> <span class="o">=</span> <span class="n">position</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">position</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">-- equal == true</span>
</code></pre></div>
<p>Compares two positions <code>p1</code> and <code>p2</code>. Returns</p>

<ul>
<li><code>true</code> if <code>p1.x == p2.x and p1.y == p2.y and p1.z == p2.z</code></li>
<li><code>false</code> otherwise</li>
</ul>
<h3 id='free-functions'>Free Functions</h3><h4 id='tostring-position-p'><code>tostring(position p)</code></h4><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">text</span> <span class="o">=</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">position</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="c1">-- text == "(3, 4, 0)"</span>
</code></pre></div>
<p>Returns <code>&quot;(&quot; .. p.x .. &quot;, &quot; .. p.y .. &quot;, &quot; .. p.z .. &quot;)&quot;</code>.</p>

<aside class="warning">
A position obtained from a character is still linked to that character and will change when the character moves.
</aside>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="n">user</span><span class="p">:</span><span class="n">forceWarp</span><span class="p">(</span><span class="n">position</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="kd">local</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">pos</span>              <span class="c1">-- pos is (0, 0, 0)</span>
<span class="n">user</span><span class="p">:</span><span class="n">forceWarp</span><span class="p">(</span><span class="n">position</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="c1">-- now user.pos AND pos are (1, 1, 0)</span>
</code></pre></div>
<blockquote>
<p>Avoid this by creating a new position from individual coordinates.</p>
</blockquote>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">position</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">pos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">user</span><span class="p">.</span><span class="n">pos</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">user</span><span class="p">.</span><span class="n">pos</span><span class="p">.</span><span class="n">z</span><span class="p">)</span>
</code></pre></div><h2 id='random'>Random</h2>
<p>Most of the time the random number generator supplied by Lua should be enough. However, if you are looking for a
statistically sound implementation of a random number generator, or if you need another distribution besides the uniform
one, this is the class you are looking for.</p>
<h3 id='functions'>Functions</h3>
<p>These functions belong to the class <code>Random</code> and not to variables of type <code>Random</code>. As such they use the <code>.</code> delimeter
instead of <code>:</code>. It is not possible to create variables of type <code>Random</code>.</p>
<h4 id='number-uniform'><code>number uniform()</code></h4><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">chance</span> <span class="o">=</span> <span class="n">Random</span><span class="p">.</span><span class="n">uniform</span><span class="p">()</span>
</code></pre></div>
<p>Returns a random floating-point value uniformly distributed in the range [0, 1).</p>
<h4 id='number-uniform-number-min-number-max'><code>number uniform(number min, number max)</code></h4><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">die</span> <span class="o">=</span> <span class="n">Random</span><span class="p">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</code></pre></div>
<p>Returns a random integer value uniformly distributed in the integer range [<code>min</code>, <code>max</code>]</p>
<h4 id='number-normal-number-mean-number-standard_deviation'><code>number normal(number mean, number standard_deviation)</code></h4><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="kd">local</span> <span class="n">chance</span> <span class="o">=</span> <span class="n">Random</span><span class="p">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">10</span><span class="p">.</span><span class="mi">75</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div>
<p>Returns a random floating-point value normally distributed with given <code>mean</code>and <code>standard_deviation</code>.</p>
<h2 id='script-variables'>Script Variables</h2>
<p><code>ScriptVars</code> is a global variable, allowing us to save values in the database and to access them with an identifier
string. Use with caution as these values have global effect. Everything in <code>ScriptVars</code> is automatically saved upon
server shutdown.</p>
<h3 id='functions'>Functions</h3><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="n">ScriptVars</span><span class="p">:</span><span class="n">set</span><span class="p">(</span><span class="s2">"welcome"</span><span class="p">,</span> <span class="s2">"Welcome to Illarion"</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">found</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">ScriptVars</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">"welcome"</span><span class="p">)</span>
<span class="n">ScriptVars</span><span class="p">:</span><span class="n">remove</span><span class="p">(</span><span class="s2">"something"</span><span class="p">)</span>
<span class="n">ScriptVars</span><span class="p">:</span><span class="n">save</span><span class="p">()</span>

</code></pre></div><h4 id='boolean-string-find-string-key'><code>boolean, string find(string key)</code></h4>
<p>Returns <code>false</code> if a ScriptVar <code>key</code> does not exist. Otherwise returns <code>true</code> and the value of ScriptVar <code>key</code>.</p>
<h4 id='boolean-remove-string-key'><code>boolean remove(string key)</code></h4>
<p>Removes ScriptVar <code>key</code> and returns <code>true</code> if there was such an entry. Returns <code>false</code> otherwise.</p>
<h4 id='save'><code>save()</code></h4>
<p>Saves all ScriptVars immediately. Use with caution, this might cause lag.</p>
<h4 id='set-string-key-number-value'><code>set(string key, number value)</code></h4><h4 id='set-string-key-string-value'><code>set(string key, string value)</code></h4>
<p>Writes <code>value</code> into ScriptVar <code>key</code>. Values are always stored as strings.</p>
<h1 id='logging'>Logging</h1>
<p>Sometimes you want to log information e.g. for game masters. You can do this with the <code>log</code> function.</p>

<p>With the local server you can view this log in the console you started the server in.</p>

<p>The Illarion <a href="https://illarion.org/~devserver/script_log.php">development server</a> and the Illarion
<a href="https://illarion.org/logs/scripts.php">game server</a> provide a summary of this log. In these
logs messages will start with the number of occurences of a specific entry, followed by a time stamp. Be aware of the
fact that access to the game server log is restricted to game masters.</p>
<h2 id='functions'>Functions</h2><h3 id='log-string-message'><code>log(string message)</code></h3><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="n">log</span><span class="p">(</span><span class="s2">"some information"</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight plaintext"><code>game-server_1  | Script (info): some information
</code></pre></div>
<p>Sends a log <code>message</code> to the server log.</p>
<h1 id='debugging'>Debugging</h1>
<p>After setting up your editor as described in the <a href="#tutorial">tutorial</a>, it will tell you about Lua syntax errors and
other problems, like the use of global variables. However, some issues will only surface at run-time. If a script throws
an error while it is running, that error will appear in the server log.</p>

<p>With the local server you can view this log in the console you started the server in.</p>

<p>The Illarion <a href="https://illarion.org/~devserver/script_error_log.php">development server</a> and the Illarion
<a href="https://illarion.org/~illarionserver/script_error_log.php">game server</a> provide a summary of script errors. In these
logs error messages will start with the number of occurences of a specific error, followed by a time stamp.</p>
<h2 id='functions'>Functions</h2>
<p>Crude mechanisms like sending debug or error messages to players and prompting them to contact a developer are not very
helpful, since you rely on the player to give a hopefully accurate report, if the report occurs at all. Instead there
are two functions you can use to send information to the server log.</p>
<h3 id='debug-string-message'><code>debug(string message)</code></h3><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="n">debug</span><span class="p">(</span><span class="s2">"some debug info"</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight plaintext"><code>game-server_1  | Script (notice): Debug Message: some debug info
game-server_1  | #1 called by: /usr/share/illarion/scripts/test.lua:11

</code></pre></div>
<p>Sends a debug <code>message</code> to the server log, including a call stack which will show where the message came from. This is
disabled on the Illarion game server.</p>

<p>Notice how the server log will show your files in the server&#39;s script directory <code>/usr/share/illarion/scripts/</code> instead
of your local script directory. After the file name, seperated by a <code>:</code> you can see the line number.</p>
<h3 id='error-string-message'><code>error(string message)</code></h3><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="nb">error</span><span class="p">(</span><span class="s2">"some error message"</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight plaintext"><code>game-server_1  | Script (err): /usr/share/illarion/scripts/test.lua:16: some error message
game-server_1  | #1 called by: [C]:-1(global error)
game-server_1  | #2 called by: /usr/share/illarion/scripts/test.lua:16
</code></pre></div>
<p>Sends an error <code>message</code> to the server log and <strong>aborts</strong> the current script. Use this to avoid running into undefined states
or to prevent potential loss of data. Just as with <code>debug</code> you will get a call stack, which will show the error&#39;s
origin.</p>
<h1 id='resources'>Resources</h1>
<p>These lists contain game content stored in the client. They can be handy during content development, to help you find a
suitable resource. Every day they are automatically generated.</p>

<ul>
<li><a href="https://illarion.org/~devserver/effects/effects.html">Graphic Effects</a></li>
<li><a href="https://illarion.org/~devserver/items/items.html">Items</a></li>
<li><a href="https://illarion.org/~devserver/music/music.html">Music</a></li>
<li><a href="https://illarion.org/~devserver/sounds/sounds.html">Sound Effects</a></li>
<li><a href="https://illarion.org/~devserver/tiles/tiles.html">Tiles</a></li>
</ul>
<h1 id='common-bugs'>Common Bugs</h1>
<ul>
<li>Missing <code>end</code>, missing <code>(</code> or <code>)</code></li>
<li>Script name and db entry do not match (be careful of invisible characters!).<br>
Try to query the db like this: <code>SELECT FROM illarionserver.items WHERE itm_script=&#39;item.doors&#39;)</code>.<br>
<code>.</code> is used to seperate directory/file names and the <code>.lua</code> extension is omitted.</li>
<li>Mixing up seperators <code>.</code> (fields) and <code>:</code> (member functions).</li>
<li>Missing <code>()</code> for functions without parameters.</li>
<li>Incorrect number of parameters for functions.</li>
<li>Mispelled function names (use syntax highlighting!).</li>
<li>Forgot !fr in game to reload tables and scripts.</li>
<li><code>=</code> instead of <code>==</code> or vice versa.</li>
<li><code>!=</code> instead of <code>~=</code> (not equal).</li>
<li>Missing conversion of a string to a number (<code>local ten = tonumber(&quot;10&quot;)</code>).</li>
<li>Beware of endless loops, they freeze the server. Always ensure that the script terminates.</li>
<li>Instructions after <code>return</code>.</li>
<li>Missing <code>then</code> in <code>if</code>-blocks, missing <code>end</code> in inline-<code>if</code>.</li>
</ul>
<h1 id='changelog'>Changelog</h1>
<table><thead>
<tr>
<th>Version</th>
<th>Date</th>
<th>Changes</th>
</tr>
</thead><tbody>
<tr>
<td>6.0</td>
<td>xx/xx/202x</td>
<td>Illarion Lua is now documented with Slate</td>
</tr>
<tr>
<td>5.24</td>
<td>12/09/2020</td>
<td><a href="https://github.com/Illarion-eV/Illarion-Server/blob/0.11.0/doc/luadoc.pdf">Last version in LaTex format</a></td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="lua">Lua</a>
          </div>
      </div>
    </div>
  </body>
</html>
